/* Copyright 2017-2019 Sean Williams
    This file is part of Modern Footnotes.
    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.
    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.
    You should have received a copy of the GNU General Public License along
    with this program; if not, write to the Free Software Foundation, Inc.,
    51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
*/
function modern_footnotes_hide_footnotes(){jQuery(".modern-footnotes-footnote a").each(function(){var o=jQuery(this);o.data("unopenedContent")&&o.html(o.data("unopenedContent"))}),jQuery(".modern-footnotes-footnote__note").hide().css({left:"",top:""}),jQuery(".modern-footnotes-footnote__connector").remove(),jQuery(".modern-footnotes-footnote--selected").removeClass("modern-footnotes-footnote--selected")}jQuery(function(o){o(document).on("click",".modern-footnotes-footnote a",null,function(t){t.preventDefault(),t.stopPropagation(),next='.modern-footnotes-footnote__note[data-mfn="'+o(this).parent().attr("data-mfn")+'"]';var e=o(this).parent().nextAll(next).eq(0);if(e.is(":hidden"))if(o(window).width()>=768&&o(this).parent().is(":not(.modern-footnotes-footnote--expands-on-desktop)")){modern_footnotes_hide_footnotes(),o(this).parent().toggleClass("modern-footnotes-footnote--selected"),e.show().addClass("modern-footnotes-footnote__note--tooltip").removeClass("modern-footnotes-footnote__note--expandable");var n=o(this).parent().position(),s=Math.floor(1.5*parseInt(o(this).parent().parent().css("font-size").replace(/px/,""))),i=e.outerWidth(),f=(o(window).width(),n.left-i/2);f<0&&(f=8),f+i>o(window).width()&&(f=o(window).width()-i);var r=parseInt(n.top)+parseInt(s);e.css({top:r+"px",left:f+"px"}),e.after('<div class="modern-footnotes-footnote__connector"></div>');var a=o(this).parent().position(),d=o(this).parent().outerHeight(),l=o(this).parent().outerWidth(),h=r-a.top-d;o(".modern-footnotes-footnote__connector").css({top:a.top+d+"px",height:h,left:a.left+l/2+"px"})}else e.removeClass("modern-footnotes-footnote__note--tooltip").addClass("modern-footnotes-footnote__note--expandable").css("display","block"),o(this).data("unopenedContent",o(this).html()),o(this).html("x");else modern_footnotes_hide_footnotes()}).on("click",".modern-footnotes-footnote__note",null,function(o){o.stopPropagation()}).on("click",".modern-footnotes-footnote__note__close a",null,function(o){o.preventDefault(),modern_footnotes_hide_footnotes()}).on("click",function(){modern_footnotes_hide_footnotes()}),o(window).resize(function(){modern_footnotes_hide_footnotes()});var t=o("body .modern-footnotes-footnote a"),e=[0];t.length>1&&t.each(function(){if(o(this).is("a[refnum]")){var t=o(this).attr("refnum");o(this).html()!=t&&o(this).html(t),!isNaN(parseFloat(t))&&isFinite(t)&&e.push(t)}else{var n=Math.max.apply(null,e)+1;o(this).html()!=n&&o(this).html(n),e.push(n)}})});